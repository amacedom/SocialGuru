/* Copyright (C) 2017 SocialGuru S.de R.L. - All Rights Reserved */ 

-- SOCIALGURU DATABASE SCHEMA

CREATE TABLE ACCOUNT_TYPES (
	TYPE 		CHAR NOT NULL PRIMARY KEY,
	TYPE_NAME 	VARCHAR(10) NOT NULL,
	DESCRIPTION VARCHAR(100) NOT NULL,
	CONSTRAINT CHECK_TYPE CHECK(TYPE='N' OR TYPE='P' OR TYPE='A' OR TYPE='V'));

/* List of possible types of accounts: 
 * Normal 
 * Promoter
 * Venue
 * Artist */

CREATE TABLE ACCOUNT_STATUS (
	STATUS 		CHAR NOT NULL PRIMARY KEY,
	STATUS_NAME	VARCHAR(10) NOT NULL,
	DESCRIPTION	VARCHAR(100) NOT NULL,
	CONSTRAINT CHECK_STATUS CHECK(STATUS='A' OR STATUS='D' OR STATUS='P' OR STATUS='C'));

/* List of possible status of an account: 
 * Active
 * Down
 * Pending
 * Cancelled */

CREATE TABLE TRANSACTION_TYPES (
	TYPE		CHAR NOT NULL PRIMARY KEY,
	TYPE_NAME	VARCHAR(10) NOT NULL,
	DESCRIPTION	VARCHAR(50) NOT NULL,
	CONSTRAINT CHECK_TYPE CHECK(TYPE='T' OR TYPE='D' OR TYPE='C' OR TYPE='R' OR TYPE='B'));

/* List of possible types of transactions:
 * Transfering money to another account (concept of paying for a service) 'T'
 * Payment for data plan (account to socialguru) 'D'
 * Returning a coupon (digital money) to a customer from socialguru 'C'
 * Returning money to customer (due to a failure in the system) 'R'
 * Payment for branding (customer to socialguru) 'B' */

 CREATE TABLE 	NOTIFICATION_TYPES (
	TYPE		CHAR NOT NULL PRIMARY KEY,
	TYPE_NAME	VARCHAR(10) NOT NULL,
	DESCRIPTION	VARCHAR(50) NOT NULL,
	CONSTRAINT CHECK_TYPE CHECK(TYPE='O' OR TYPE='P' OR TYPE='F'));

/* List of possible types of notifications:
 * Opportunity (when artist is available)
 * Promote your venue or service
 * Feedback socialguru */

CREATE TABLE CUSTOMERS ( 
	CUST_ID 		INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
	FIRST_NAME 		VARCHAR(30) NOT NULL,
	LAST_NAME 		VARCHAR(30),
	ADDR1			VARCHAR(50),
	ADDR2			VARCHAR(50),
	ZIPCODE			INT(5),
	COUNTRY			VARCHAR(15) NOT NULL,
	MEMBER_SINCE 	DATE NOT NULL)
	AUTO_INCREMENT = 1;

/* The customers personal information, this can be obtained from facebook for example */

CREATE TABLE ACCOUNTS (
	ACCOUNT_ID		INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
	CUST_ID			INT NOT NULL,
	ACCOUNT_TYPE 	CHAR NOT NULL,
	ACCOUNT_STATUS	CHAR NOT NULL,
	PHONE_NUMBER	VARCHAR(15),
	COMPANY_NAME	VARCHAR(30),
	USERNAME		VARCHAR(12),
	EMAIL			VARCHAR(30),
	PASSWORD		VARCHAR(15),
	CURRENT_BALANCE	FLOAT(10,2),
	PREV_BALANCE	FLOAT(10,2),
	DATE_CREATED	DATE NOT NULL,
	LAST_CHECKOUT	TIMESTAMP,
	LAST_SIGN_IN	TIMESTAMP,
	FOREIGN KEY(CUST_ID) REFERENCES CUSTOMERS(CUST_ID),
	FOREIGN KEY(ACCOUNT_TYPE) REFERENCES ACCOUNT_TYPES(TYPE),
	FOREIGN KEY(ACCOUNT_STATUS) REFERENCES ACCOUNT_STATUS(STATUS))
	AUTO_INCREMENT = 1;

/* The table accounts represent the official information of the customer
 * Important info such as the password, email, etc will be stored here. */

CREATE TABLE TRANSACTIONS (
	TXN_ID		INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
	ACCOUNT_ID	INT NOT NULL,
	TXN_TYPE	CHAR NOT NULL,
	AMOUNT		FLOAT(10,2) NOT NULL,
	DESCRIPTION VARCHAR(50) NOT NULL,
	TXN_TT		TIMESTAMP NOT NULL,
	FOREIGN KEY(ACCOUNT_ID) REFERENCES ACCOUNTS(ACCOUNT_ID),
	FOREIGN KEY(TXN_TYPE) REFERENCES TRANSACTION_TYPES(TYPE))
	AUTO_INCREMENT = 1;

/* An account can have multiple transactions, and there can be 
 * several types of transactions. */

CREATE TABLE DATA_SUITES (
	SUITE_ID 		CHAR NOT NULL PRIMARY KEY,
	SUITE_NAME		VARCHAR(15) NOT NULL,
	ARTISTS			VARCHAR(30) NOT NULL,
	DATA_HISTORY	VARCHAR(30) NOT NULL,
	DEVICES			INT(2) NOT NULL,
	SUPPORT			VARCHAR(30) NOT NULL,
	DESCRIPTION		VARCHAR(50) NOT NULL,
	PRICE			FLOAT(10,2) NOT NULL)
	AUTO_INCREMENT = 1;

/* These are the data suites that we will offer to the promoters */

CREATE TABLE BRANDING_PLANS (
	PLAN_ID			INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
	PLAN_NAME 		VARCHAR(15) NOT NULL,
	DESCRIPTION		VARCHAR(50) NOT NULL,
	PRICE			FLOAT(10,2) NOT NULL)
	AUTO_INCREMENT = 1;

CREATE TABLE COMMISSION_FEES (
	COMMISSION_ID	INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
	NAME			VARCHAR(15) NOT NULL,
	DESCRIPTION 	VARCHAR(50) NOT NULL,
	PERCENTAGE		FLOAT(3,2) NOT NULL) 
	AUTO_INCREMENT = 1;

CREATE TABLE NOTIFICATIONS (
	NOTIFICATION_ID		INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
	ACCOUNT_ID			INT NOT NULL,
	NOTIFICATION_TYPE	CHAR NOT NULL,
	NOTIFICATION_TT		TIMESTAMP NOT NULL,
	DATE_SENT			DATE NOT NULL,
	DESCRIPTION VARCHAR(50) NOT NULL,
	FOREIGN KEY(ACCOUNT_ID) REFERENCES ACCOUNTS(ACCOUNT_ID),
	FOREIGN KEY(NOTIFICATION_TYPE) REFERENCES NOTIFICATION_TYPES(TYPE))
	AUTO_INCREMENT = 1;

CREATE TABLE VENUES (
	VENUE_ID		INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
	ACCOUNT_ID		INT NOT NULL,
	NAME 			VARCHAR(20) NOT NULL,
	ADDR1			VARCHAR(30) NOT NULL,
	ADDR2 			VARCHAR(30),
	ZIPCODE			INT(5) NOT NULL,
	CITY			VARCHAR(10) NOT NULL,
	STATE			VARCHAR(10) NOT NULL,
	PHONE_NUMBER	VARCHAR(15),
	MIN_CAPACITY	INT NOT NULL,
	MAX_CAPACITY	INT NOT NULL,
	VENUE_REVIEWS	INT NOT NULL,
	VENUE_IMAGES	INT NOT NULL,
	FOREIGN KEY(ACCOUNT_ID) REFERENCES ACCOUNTS(ACCOUNT_ID),
	FOREIGN KEY(VENUE_REVIEWS) REFERENCES VENUE_REVIEWS(VENUE_REVIEWS),
	FOREIGN KEY(VENUE_IMAGES) REFERENCES VENUE_IMAGES(VENUE_IMAGES),
	CONSTRAINT CHECK_CAPACITY CHECK(MAX_CAPACITY > MIN_CAPACITY))
	AUTO_INCREMENT = 1;

/*CREATE TABLE ARTISTS (
	ARTIST_ID	INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
	ACCOUNT_ID 	INT NOT NULL,
	)*/

DROP TABLE NOTIFICATIONS;
DROP TABLE TRANSACTIONS;
DROP TABLE VENUES;
DROP TABLE ACCOUNTS;
DROP TABLE NOTIFICATION_TYPES;
DROP TABLE TRANSACTION_TYPES;
DROP TABLE ACCOUNT_TYPES;
DROP TABLE ACCOUNT_STATUS;
DROP TABLE CUSTOMERS;
DROP TABLE DATA_SUITES;
DROP TABLE BRANDING_PLANS;
DROP TABLE COMMISSION_FEES;
